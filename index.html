<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redux</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.7.2/redux.min.js"></script>
    <script src="https://unpkg.com/react@16.3.0-alpha.1/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16.3.0-alpha.1/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>


</head>

<body>
    <div id='App'></div>
    <script>
    
//App code
function generateId() {
    return (
      Math.random().toString(36).substring(2) + new Date().getTime().toString(36)
    );
  }
  
  const ADD_TODO = "ADD_TODO";
  const REMOVE_TODO = "REMOVE_TODO";
  const TOGGLE_TODO = "TOGGLE_TODO";
  const ADD_GOAL = "ADD_GOAL";
  const REMOVE_GOAL = "REMOVE_GOAL";

//-----------Action Creators-----------
function addTodoCreator(todo) {
    return {
      type: "ADD_TODO",
      todo,
    };
  }
  function removeTodoCreator(id) {
    return {
      type: "REMOVE_TODO",
      id,
    };
  }
  function toggleTodoCreator(id) {
    return {
      type: "TOGGLE_TODO",
      id,
    };
  }
  function addGoalCreator(goal) {
    return {
      type: "ADD_GOAL",
      goal,
    };
  }
  function removeGoalCreator(id) {
    return {
      type: "REMOVE_GOAL",
      id,
    };
  }
    



//-------------Reducers start----------
function todos(state = [], action) {
  switch (action.type) {
    case ADD_TODO:
      return state.concat([action.todo]);
    case REMOVE_TODO:
      return state.filter((todo) => todo.id !== action.id);
    case TOGGLE_TODO:
        return state.map((todo) => todo.id !== action.id ? todo :
        Object.assign({}, todo, { complete: !todo.complete }));
    default:
      return state;
  }
}

function goals(state = [], action) {
  switch (action.type) {
    case ADD_GOAL:
      return state.concat([action.goal]);
    case REMOVE_GOAL:
      return state.filter((goal) => goal.id !== action.id);
    default:
      return state;
  }
}
//-------Reducers end--------------------

//------middleware start---------------
const checker = (store) => (next) => (action) => {
  if (
      action.type === "ADD_TODO" &&
      action.todo.name.toLowerCase().includes("blockchain")
    ) {
      return alert("Nope!this is not a good idea....");
    } else if (
      action.type === "ADD_GOAL" &&
      action.goal.name.toLowerCase().includes("blockchain")
    ) {
      return alert("Nope!this is not a good idea....");
    } else {
      return next(action);
    } 
}
const logger = (store) => (next) => (action) => {
  console.group(action.type)
  console.log("the action : ",action)
  const result = next(action)
  console.groupEnd()
  return result
}
//------middleware end---------------

//-------------------THE STORE------------
const store = Redux.createStore(Redux.combineReducers({
    todos,
    goals,
}),Redux.applyMiddleware(checker, logger));
//---------------******-----------------
    </script>
    <script type="text/babel">
        function List(props){
            return (
                <ul>
                    
                {props.items.map(item=>(
                    <li key={item.id}>
                        <span 
                        onClick={()=>props.toggle && props.toggle(item.id)}
                        style={{textDecoration:item.complete?"line-through":"none"}}
                        >
                            {item.name}
                        </span>
                        <button onClick={()=>props.removeButton(item.id)}>X</button>
                    </li>
                ))}
                </ul> 
            )
        }


        class Todos extends React.Component {
                addItem = (e) => {
                    e.preventDefault()
                    const name = this.input.value
                    
                    this.input.value = ''
                    
                    store.dispatch(addTodoCreator({
                                name,
                                id: generateId(),
                                complete: false,
                            })
                        )
                }
                removeBtn = (id) => {
                    store.dispatch(removeTodoCreator(id))
                }
                toggleItem = (id) => {
                    store.dispatch(toggleTodoCreator(id))
                }
            render() {
                return (
                    <div>
                    
                        <h1>Todo List</h1>
                        <input
                            placeholder='add todo'
                            type='text'
                            ref={(input) => this.input = input}
                        />
                        <button onClick={this.addItem}>Add Todo</button>
                        <List items={this.props.todos} removeButton={this.removeBtn} toggle={this.toggleItem} />
                    </div>
                )
            }
        }

        class Goals extends React.Component {
            addItem = (e) => {
                    e.preventDefault()
                    const name = this.input.value
                    
                    this.input.value = ''
                    
                    store.dispatch(addGoalCreator({
                                name,
                                id: generateId(),
                            })
                        )
                }
                removeBtn = (id) => {
                    store.dispatch(removeGoalCreator(id))
                }
            render() {
                return (
                    <div>
                        
                        <h1>Goal List</h1>
                        <input
                            placeholder='add goal'
                            type='text'
                            ref={(input) => this.input = input}
                        />
                        <button onClick={this.addItem}>Add Goal</button>
                        <List items={this.props.goals} removeButton={this.removeBtn} />
                    </div>
                )
            }
        }
        class App extends React.Component {
            componentDidMount(){
                store.subscribe(()=>this.forceUpdate())
            }
            render() {
                const {goals, todos} = store.getState()
                return (
                    
                    <div>
                        <Todos todos={todos} store={this.props.store} />
                        <Goals goals={goals} />
                    </div>
                )
            }
        }
       
       
        ReactDOM.render(
            <App store={store} />
            ,document.getElementById('App')
            );


    </script>
</body>

</html>